---
title: "Project Report"
author: "Caroline Andy, Vasili Fokaidis, Stella Li, Tessa Senders, Lily Wang"
date: "12/11/2020"
output: pdf_document
---

```{r message=FALSE, warning=FALSE, echo = FALSE}
library(tidyverse)
library(arsenal)
library(MASS)
library(patchwork)
library(modelr)
library(car)
set.seed(1)

hate_crimes_df <- read.csv("./data/HateCrimes.csv") %>%
  janitor::clean_names() %>%
  rename(perc_pop_hs = perc_population_with_high_school_degree) %>%
  mutate(hate_crimes_per_100k_splc = as.numeric(hate_crimes_per_100k_splc)) %>%
  drop_na(hate_crimes_per_100k_splc) %>% 
  mutate(unemployment = as_factor(unemployment),
         urbanization = as_factor(urbanization))
```

## Abstract
**Background:**\ 
Hate crimes are a growing public health threat in the United States and are the highest priority of the FBI’s civil rights program (Miller et al., 2016). Existing research suggests that various community-level socioeconomic factors, such as income inequality, are associated with hate crime rate. 

**Objectives:**\
We aimed to analyze the association between community-level variables and state-level hate crime rates using data reported to the Southern Poverty Law Center and analyzed in a 2017 FiveThrityEight article (Majumder, 2017).

**Methods:**\
The data used for this project included state-level hate crime rates per 100,000 individuals in the population, as reported by the Southern Poverty Law Center during the first weeks of November, 2016. Data elements also included socioeconomic factors that are hypothesized to be associated with hate crime. 

The association between these socioeconomic factors and the hate crime rate outcome were examined using multivariable linear regression analysis. The outcome variable was first natural log transformed to adhere to the linear regression assumption of normal distribution. After identifying the statistically significant predictors of state-level hate crime rate when controlling for all other covariates, we used automated and criterion-based approaches to generate a parsimonious model that fit our data well. 

Multicollinearity of covariates, outliers, and variable interaction were also tested for and considered in model development. 

Finally, we assessed model goodness of fit and predictive performance through model validation. All steps of model development and validation were performed before and after removing the District of Columbia, an outlier in the data. 

**Results:**\
Gini Index (an indicator of wealth inequality) and percent population with a high school degree were both significant predictors of state-level hate crime rate when controlling for all other covariates. 

Of the continuous variables, percent non-citizen and percent non-white were found to have a correlation coefficient of 0.753; median household income and percentage of population with a high school degree had a correlation coefficient of 0.651, both of which may suggest multicollinearity. No statistically significant interactions were identified between any variables in regression modeling. 

Using automated and criterion-based approaches, and considering the body of scientific evidence with regard to significant and practically important socioeconomic factors associated with hate crimes, we identified a regression model which optimizes parsimony and goodness of fit. This model contains only the Gini Index and percent population with a high school degree as predictors. 

All steps of model development and validation were performed before and after removing the District of Columbia, an outlier in the data. After removing the District of Columbia, the Gini Index is no longer a statistically significant predictor of hate crime rate; instead, the percentage of the population with a high school degree is the only significant variable, making the District of Columbia an influential point. 

**Conclusions:**\
Based on the November 2016 Southern Poverty Law Center data, Gini Index (an indicator of wealth inequality) and percent population with a high school degree were both statistically significantly and independently associated with state-level hate crime rate. 

## Introduction

As of 2020, the national rate of hate crimes in the United States is at its highest level in over a decade ["FBI Incidents and Offenses," 2019]. In the days following the 2016 US Presidential election, an average of 90 hate crimes per day were reported to the Southern Poverty Law Center (Miller et al., 2016). 

Existing research suggests that community-level socioeconomic factors such as racial breakdown, population density, level of educational attainment, and economic considerations (median income, poverty level, job availability) may be significant predictors of regional and state-level rates of hate crimes (Shively, 2005, “FBI: Variables Affecting Crime,” 2012). A 2017 FiveThirtyEight article titled, "Higher Rates Of Hate Crimes Are Tied To Income Inequality," used 2016 FBI and Southern Poverty Law Center data to assess the association between hate crime rate and select community-level variables (Majumder, 2017).  

For this project, we used this dataset to critically analyze this research team's findings to identify state-level variables associated with rates of hate crimes, and to generate a high performing predictive model for population-adjusted hate incidents in the United States.   


## Methods

#### Data Exploration

The data used for this project included state-level hate crime rates (hate crimes per 100,000 population), as reported by the Southern Poverty Law Center during the first weeks of November, 2016. Collected state-level demographic variables include: 

- Unemployment rate (high vs low) (as of 2016)
- Urbanization (high vs low) (as of 2015)
- Median household income (as of 2016)
- Percent of residents with a high school degree (as of 2009)
- Percent of residents who are non-citizens (as of 2015)
- Income Gini coefficient (a measure of the extent to which the distribution of income among individuals within an economy deviates from a perfectly equal distribution; as of 2015)
- Percent of residents who are non-White (as of 2015)

First, we investigated the extent of missing data in our dataset. Four states--Hawaii, North Dakota, South Dakota, and Wyoming--did not report hate crime rate data, and thus were excluded from subsequent analyses. Three states--Maine, Mississippi, and South Dakota did not report their percent of residents who were non-citizens. The District of Columbia was included as a state for the purposes of these analyses. 

Using these data, our goal was to construct our own multivariable linear regression models to assess which of the collected variables, if any, are statistically significantly associated (at a 0.05 significance level) with population-adjusted hate incidents in the United States, to altogether critically examine the article's findings. To do so, we first generated descriptive statistics that we reported in a table which includes the mean, median, range (min-max), interquartile range, and count of missing entries for each numeric variable, and category percent breakdowns and count of missing entries for categorical variables (Table 1). 


In order to determine whether any data transformations would be necessary we visualized the distribution of the outcome(population-adjusted hate incidents per 100,000 population) by generating an overlaid density and histogram plot (Figure 1). Multivariable linear regression modeling operates under several assumptions, which include residual homoscedasticity (constant variance) and normality. Initial exploration of the distribution of the hate crimes rate data showed a strong departure from standard normal distribution with significant right skewness. Thus, we performed a Box Cox transformation to isolate the 'best' power transformation on the hate crimes rate variable to achieve normal residuals. 

To elucidate the existence of outliers and thus potential influential points, we visualized the hate crime rate by state. We then generated residuals vs fitted, normal Q-Q, scale-location, and residuals vs leverage plots for a linear regression model that regressed the transformed hate crime rate onto all possible covariates (Figures 3-4). We looked at the Residuals vs Leverage plot specifically to find any outliers.  Any points outside of Cook's Distance were considered potential influential points.  Any states that were deemed to be outliers were included in the subsequent analyses, but the same analyses were also run a second time on the dataset excluding the outliers for comparison in order to determine if the outlier was indeed influencing the results of our analyses.


#### Multicollinearity and Interactions

In order to investigate the existence of multicollinearity between each of the continuous variables, we generated a correlation matrix. We decided that any correlation coefficient of 0.6 and above may suggest multicollinearity; thus, in these instances, at least one of those correlated variables were dropped during subsequent model development. Furthermore, we calculated the variance inflation factors (VIFs) for all variables, which quantify the degree of multicollinearity between the given predictor all other remaining covariates. 

Next, we plotted potential interactions between the continuous variables and each categorical variable; urbanization and unemployment. These plots were created once including outliers and once excluding outliers. We then formally tested for significant interactions between any variable pairs with intersecting lines. All interaction tests were performed on datasets containing and not containing any observed outliers. 

#### Model Development and Validation

We began by performing two automated procedures for model variable selection (forward and backward stepwise selection). We then used two criterion based approaches (Mallow's Cp and adjusted r-squared). Using these results, we then identified the two best models which maximize parsimony, interpretability and practical application, which takes into account variables deemed to be significant and practically important in existing literature. 
 
We repeated this process of model selection on the dataset excluding any observed outliers. 

To assess the two models' predictive performance, we performed 5-fold Cross Validation on each including and excluding outliers.

## Results

#### Data Exploration

The generated Box Cox transformation plot indicates that a lambda of 0 (i.e. a natural logarithmic transformation of the hate crimes rate outcome) would most closely approximate normal distribution (Figure 2). Thus, we operated moving forward in model development using the natural log of hate crimes rate as the outcome of interest. 

Looking at the Residuals vs Leverage plot generated from the regression model including all possible covariates, the District of Columbia is clearly outside of the Cook's Distance line, and thus we concluded that this point is an outlier and a potential influential point.

A table of basic descriptive statistics for the collected socioeconomic variables is included in the appendix (Table 1). 

[WRITE SUMMARY OF TABLE RESULTS - Vasili]

#### Multicollinearity and Interactions

Out of the continuous variables, percent non-citizen and percent non-white has a correlation coefficient of 0.753, median household income and percentage of population with a HS degree has a correlation coefficient of 0.651, both of which may suggest multicollinearity. All other correlation coefficients do not suggest multi-collinearity (Table 2).

Use of variance inflation factors (VIFs) showed that the percent population without a high school degree (3.895), percent non-citizen (3.728), percent non-white (3.236) and median household income (3.108) had the highest degrees of multicollinearity between all other predictors. These values approach but do not exceed 4, the generally accepted value which denotes the need for further investigation and/or consideration of multicollinearity corrections. 

For the dataset containing Washington DC, the interaction plots suggest potential interactions between unemployment and median household income, as well as between unemployment and percent population of high school graduates, as seen by the differing directions in slope (crossing lines). 

The urbanization interaction plots for these data suggest that there may be potential interaction bewteen urbanization and each of the following variables: gini index, median household income, percent non-citizen, and percent population of high school graduates.

For the dataset excluding Washington DC, the interaction plots show potential interaction between unemployment and gini index as well as between unemployment and percent population of high school graduates.

The urbanization interaction plots for these data suggest potential interaction between urbanization and median household income as well as between urbanization and percent population of high school graduates.

When performing regression analyses for all of the above interactions for each dataset, no interactions were found to be statistically significant at a 0.05 significance level.

#### Model Development and Validation

We began our regression analyses by running linear regression models containing all possible predictors for both the untransformed hate crime rate and the log hate crime rate. Our results support the conclusions drawn in the FiveThirtyEight article: that the Gini Index was the most significant independent predictor of state hate crime rate when controlling for all other covariates; percent high school graduates variables was the only other statistically and independently significant variable (Majumder, 2017). 

To generate our own models maximizing model parsimony and predictive performance, we employed two automated procedures: backward and forward selection. While the model proposed during forward selection contained all provided variables (Adjusted R-squared = 0.1849), the model generated through backwards selection was much more parsimonious and had a substantially higher adjusted R squared (Adjusted R-squared = 0.2868). The only included predictors were the Gini Index, and the percent of high school graduates variables. 

We then employed two criterion based approaches in R, each of which generated the two best performing models which optimize the given criterion for each possible number of predictors. The first of these approaches used the Cp criterion, which compares the predictive ability of model subsets to the full model. To visualize these results, we generated a plot containing the Cp criterion distribution for the top performing model for each number of predictors (Figure 8). This shows that the best performing model with 2 covariates (Gini Index and percent high school graduates) had the best predictive performance as compared to the top performing models of all other possible sizes. 

We also isolated the top two best performing models per number of predictors using the adjusted R squared criterion. We then generated a plot of the distribution of the adjusted R squared statistic for the top performing model for each number of included predictors (Figure 9). Results show that the model with three predictors performed the best, with an R squared value marginally higher than that of the two parameter model. This three-predictor model contains the following variables: Gini Index, percent high school graduates, and unemployment. 

Through cross-validation, we determined that the aforementioned two-predictor model also had better predictive performance (RMSE = 0.5949 than the  three-predictor model (RMSE = 0.6038), indicating that the addition of unemployment as a third predictor did not significantly add to model performance (Table 4). This is particularly apparent as this variable is not significant when added to the model.

Finally, because Washington DC was previously determined to be an outlier, we replicated all model generation steps excluding it. When including all possible parameters, no variables were found to be significant predictors of hate crime rate, controlling for all other variables. When running the two-parameter model on the data excluding Washington DC, the Gini Index became an insignificant predictor; only the percent population of high school graduates variable was a significant parameter. The adjusted R-squared of the total model decreased as well (from 0.2541 to 0.1185). However, predictive value increased (RMSE = 0.5554, MAE = 0.4741).

[INCLUDE TABLE OF RMSE AND ADJUSTED R SQUARED FOR MODELS CONTAINING DC AND NOT CONTAINING DC - TESSA]

## Discussion/Conclusion

After extensive analyses and modeling, we found that the optimal models in terms of goodness of fit and predictive value contained Gini index and percent population with a high school degree, with the latter variable being a more significant predictor of hate crime. However, these two predictors only accounted for 25.4% of the variability in the data. 

The drastic changes in predictor significance and adjusted R-squared between the model including and excluding Washington DC suggest that the district is indeed an influential point. The district has the highest hate crime rate and the highest income inequality out of all the states. 

It is possible that other factors not included in our dataset, such as percentage of the population who are LGBTQ+ or religious minorities, may also be important predictors of hate crime.

- limitations
- suggestions for possible future studies 

## Figures and Tables

```{r, message = FALSE, warning = FALSE, echo = FALSE}
## FIGURE 1
hate_crimes_df %>%
  ggplot(aes(x = hate_crimes_per_100k_splc)) +
  geom_histogram(aes(y=..density..)) +
  geom_density(alpha=.1, fill="#FF6666") + 
  labs(
    title = "Figure 1. Untransformed distribution of hate crimes per 100k population",
    x = "Hate Crimes Per 100k",
    y = "Density"
  )
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
## FIGURE 2
mult_fit_1 = lm(hate_crimes_per_100k_splc ~ unemployment + urbanization + median_household_income + perc_pop_hs + perc_non_citizen + gini_index + perc_non_white, data = hate_crimes_df)

boxcox(mult_fit_1)
title("Figure 2. BoxCox Transformation Plot", side = 3, line = -2, outer = TRUE)
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
## FIGURE 3
hate_crimes_df = hate_crimes_df %>%
  mutate(hate_crimes_log = log(hate_crimes_per_100k_splc)) 

hate_crimes_df %>%
  drop_na(hate_crimes_log) %>%
  mutate(state = fct_reorder(state, hate_crimes_log)) %>%
ggplot(aes(x = state, y = hate_crimes_log)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust = 1)) +
  labs(
    x = "State",
    y = "Log Hate Crimes per 100,000 Population",
    title = "Figure 3. Log Hate Crimes Rate by State"
  )
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
## FIGURES 4
par(mfrow = c(2,2))
plot(mult_fit_1)
title("Figure 4. Full Model Hate Crime Diagnostic Plots", side = 3, line = -2, outer = TRUE)

hate_crimes_df_no_DC <- hate_crimes_df %>%
  filter(state != "District of Columbia") %>%
  mutate(hate_crimes_log = log(hate_crimes_per_100k_splc))

final_model_no_DC <- lm(hate_crimes_log ~ gini_index + perc_pop_hs, data = hate_crimes_df_no_DC )
plot(final_model_no_DC)
title("Figure #. Two predictors without DC model Hate Crime Diagnostic Plots", side = 3, line = -2, outer = TRUE)
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
## TABLE 1
h_c_df =
  hate_crimes_df %>%
  rename(
    Unemployment = "unemployment",
    Urbanization = "urbanization",
    "Median Household Income" = "median_household_income",
    "% Adults >25yrs With HS Degree" = "perc_pop_hs",
    "% of Population Not U.S. Citizens" = "perc_non_citizen",
    "% of Population Not White" = "perc_non_white",
    "Gini Index" = "gini_index",
    "Hate Crime Rate Per 100k" = "hate_crimes_per_100k_splc"
  ) %>%
  dplyr::select(-state)

my_controls = tableby.control(
               total = T,
               test=F,  
               numeric.stats = c("meansd", "medianq1q3", "range", "Nmiss2"),
               cat.stats = c("countpct", "Nmiss2"),
               stats.labels = list(
               meansd = "Mean (SD)",
               medianq1q3 = "Median (Q1, Q3)",
               range = "Min - Max",
               Nmiss2 = "Missing",
               countpct = "N (%)"))

tab1 = tableby( ~ ., data = h_c_df, control = my_controls)

summary(tab1) %>% 
  knitr::kable(caption = "Descriptive Statistics of States Reporting Hate Crimes")
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
## Figure 5
hate_crimes_df %>% 
  drop_na(perc_non_citizen) %>%
  dplyr::select(!(state:urbanization)) %>% 
  cor() %>% 
  corrplot::corrplot(method = "square", addCoef.col = "black", tl.col="black", tl.srt=45, insig = "blank", diag=FALSE, number.cex = .7, title = "Figure 5. Correlation Matrix", mar = c(0,0,1,0))
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
# TABLE 2
vif(lm(hate_crimes_log ~. - hate_crimes_per_100k_splc - state, data=hate_crimes_df)) %>%
  round(.,3) %>%
  knitr::kable(col.names = "VIF", caption = "VIF Values")
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
# FIGURE 6
hate_crimes_df %>% pivot_longer(median_household_income:perc_non_white, names_to = "cont_var", values_to = "value") %>% rename(Unemployment = "unemployment") %>% ggplot(aes(x = value, y = hate_crimes_log, color = Unemployment)) + geom_point() + geom_smooth(method='lm', se=FALSE) + facet_wrap(~cont_var, scales = "free_x") + labs(title = "Figure 6. Interaction Plots Between Hate Crime and All Continuous Variables by Unemployment Level", y = "Hate Crime (log)", x = "Value")
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
# FIGURE 7 
hate_crimes_df %>% 
  pivot_longer(median_household_income:perc_non_white, names_to = "cont_var", values_to = "value") %>%
  rename(Urbanization = "urbanization") %>%
  ggplot(aes(x = value, y = hate_crimes_log, color = Urbanization)) +
  geom_point() + 
  geom_smooth(method='lm', se=FALSE) + 
  facet_wrap(~cont_var, scales = "free_x") + labs(title = "Figure 7. Interaction Plots Between Hate Crime and All Continuous Variables by Urbanization Level", y = "Hate Crime (log)", x = "Value")
```


```{r, message = FALSE, warning = FALSE, echo = FALSE}
## FIGURE 8
# Printing the 2 best models of each size, using the Cp criterion:
hc = hate_crimes_df %>%
  drop_na() %>%
  dplyr::select(-hate_crimes_per_100k_splc, -state) %>%
  mutate(unemployment = as.numeric(unemployment),
         urbanization = as.numeric(urbanization))

# leaps::leaps(x = hc[,1:7], y = hc[,8], nbest=2, method="Cp")

# Printing the 2 best models of each size, using the adjusted R squared criterion:

# leaps::leaps(x = hc[,1:7], y = hc[,8], nbest=2, method="adjr2")

b <- leaps::regsubsets(hate_crimes_log ~ ., data=hc)
rs <- summary(b)

par(mar=c(4,4,4,4))
par(mfrow=c(1,2))

plot(1:7, rs$cp, xlab="No. of parameters", ylab="Cp Statistic")
abline(0,1)

plot(1:7, rs$adjr2, xlab="No. of parameters", ylab="Adj R2")
title("Figure 8. CP Statistic and Adjusted R-Squared Plots", side = 3, line = -2, outer = TRUE)
```

```{r, message = FALSE, warning = FALSE, echo = FALSE}
# ADD TABLE FOR RMSE AND ADJ R SQUARED RESULTS
table_rmse_rsquare <- matrix(c(0.2541,0.5417445,0.2943289,0.5948853,0.2571, 0.5341956,0.2783783,0.6038494,0.1185,0.5367246,0.153031,0.5554347,0.125,0.5281813,0.1730294,0.560014),ncol=4,byrow=TRUE)
colnames(table_rmse_rsquare) <- c("Model adjusted R^2","Model RMSE", "CV adjusted R^2", "CV RMSE")
rownames(table_rmse_rsquare) <- c("Two predictors with DC","Three predictors with DC","Two predictors without DC","Three predictors without DC")
table_rmse_rsquare <- as.table(table_rmse_rsquare)
table_rmse_rsquare %>%
  knitr::kable(caption = "Comparison of adjusted R^2 and RMSE with all models")
```


^^^ check these plots since the numbers seem weird 




## References

- Dyke, Nella Van, and Griff Tester. “Dangerous Climates.” Journal of Contemporary Criminal Justice, vol. 30, no. 3, 2014, pp. 290–309., doi:10.1177/1043986214536666. 
- “Incidents and Offenses.” FBI, FBI, 29 Oct. 2019, ucr.fbi.gov/hate-crime/2019/topic-pages/incidents-and-offenses. 
- Majumder, M. “Higher Rates Of Hate Crimes Are Tied To Income Inequality.” FiveThirtyEight, FiveThirtyEight, 23 Jan. 2017, fivethirtyeight.com/features/higher-rates-of-hate-crimes-are-tied-to-income-inequality/. 
- Miller, C., Werner-Winslow, A. “Ten Days After: Harassment and Intimidation in the Aftermath of the Election.” Southern Poverty Law Center, 29 Nov. 2016, www.splcenter.org/20161129/ten-days-after-harassment-and-intimidation-aftermath-election.  
- Shively, Michael. Abt Associates Inc, 2005, Study of Literature and Legislation on Hate Crime in America. 
- “Variables Affecting Crime.” FBI, FBI, 5 Nov. 2012, ucr.fbi.gov/hate-crime/2011/resources/variables-affecting-crime. 

